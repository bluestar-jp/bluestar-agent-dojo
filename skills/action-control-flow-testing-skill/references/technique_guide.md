# Control Flow Testing Guide

- Purpose: 制御フローテストの詳細ガイド（ISTQB準拠）
- Scope: CFG作成、サイクロマティック複雑度、ループテスト

## 概要

制御フローテストは、プログラムの制御フローグラフ（CFG）を作成し、独立パスを特定してテストケースを導出する構造ベースの技法である。

## 制御フローグラフ（CFG）の作成

### 基本ブロック

- 連続して実行される文の集合
- 途中での分岐なし、途中からの合流なし

### 制御構造のCFG変換

| 構造 | 特徴 |
| --- | --- |
| if-else | 分岐ノード + 2本のエッジ + 合流ノード |
| switch-case | 分岐ノード + N本のエッジ + 合流ノード |
| while | ループ判定ノード + 本体ノード + 戻りエッジ |
| for | 初期化ノード + ループ判定 + 本体 + 更新 + 戻りエッジ |
| try-catch | 通常パス + 例外パス + finallyノード |

## サイクロマティック複雑度

### 計算方法

- **V(G) = E - N + 2P**
  - E: エッジ数
  - N: ノード数
  - P: 連結コンポーネント数（通常1）
- **V(G) = 分岐数 + 1**（簡易計算）

### 複雑度の解釈

| V(G) | 評価 | テスト戦略 |
| --- | --- | --- |
| 1-10 | 単純 | 全独立パスをテスト |
| 11-20 | 中程度 | 全独立パスをテスト + リスク分析 |
| 21-50 | 複雑 | リスクベースでパスを選択 |
| 50+ | 非常に複雑 | リファクタリング推奨 |

## 独立パスの特定

1. 基底パス（最も単純なパス）を選択
2. 1つの条件を変更した新しいパスを追加
3. V(G)個のパスが得られるまで繰り返し

## ループテスト戦略

| テストケース | 説明 |
| --- | --- |
| 0回実行 | ループをスキップ |
| 1回実行 | 最小実行 |
| 2回実行 | 典型的な少数回 |
| m回実行 | 典型的な回数 |
| max-1回 | 最大値の手前 |
| max回 | 最大実行回数 |
| max+1回 | 境界超過（エラーケース） |

## ネストされた制御構造

- 外側ループを最小回数に固定し、内側ループをテスト
- 次に外側ループを変化させてテスト
- 相互作用が疑われる場合はクリティカルな組合せを追加
