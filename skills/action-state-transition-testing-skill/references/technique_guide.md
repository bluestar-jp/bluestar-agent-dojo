# State Transition Testing Guide

- Purpose: 状態遷移テストの詳細ガイド（ISTQB準拠）
- Scope: 状態遷移図/表の作成、カバレッジ基準、無効遷移

## 概要

状態遷移テストは、システムの状態、イベント、アクション、遷移を分析し、状態遷移の正当性と異常処理をテストする技法である。

## 状態遷移図の作成

- **状態（ノード）**: 円で表現。初期状態は二重丸、終了状態は太枠
- **遷移（エッジ）**: 矢印で表現。イベント/ガード条件/アクションを記載
- **表記**: `イベント [ガード] / アクション`

## 状態遷移表の作成

| 現状態＼イベント | イベント1 | イベント2 | イベント3 |
| --- | --- | --- | --- |
| 状態A | 状態B | -- | 状態C |
| 状態B | -- | 状態C | -- |
| 状態C | 状態A | -- | -- |

- `--`: 無効遷移（このイベントはこの状態では発生しないはず）

## カバレッジ基準

### 0-switchカバレッジ（最低限）

- すべての有効な遷移を少なくとも1回実行
- テストケース数 = 有効遷移数

### 1-switchカバレッジ（推奨）

- 連続する2つの遷移の組合せをすべてカバー
- テストケース数 > 有効遷移数

### N-switchカバレッジ

- 連続するN+1個の遷移の組合せをカバー
- リスクの高い遷移シーケンスに限定して適用

## 無効遷移テスト

- 状態遷移表の`--`セルを対象
- 無効イベントに対してシステムが適切に対処することを検証
- 期待動作: エラーメッセージ、状態維持、ログ記録等

## ガード条件の扱い

- 同じイベントでもガード条件によって遷移先が異なる場合がある
- 各ガード条件の真偽でテストケースを分岐

## 状態爆発への対処

- 状態数が多い場合はリスクベースで重要な遷移パスに絞る
- 階層的状態マシン（サブステート）を活用して複雑度を管理
